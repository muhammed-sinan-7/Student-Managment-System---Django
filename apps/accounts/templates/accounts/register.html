{% extends "base.html" %}

{% block body %}
<style>
  .page-wrap {
    min-height: 100vh;
    background: #0f172a;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 1rem;
  }
  .form-card {
    width: 100%;
    max-width: 420px;
    border-radius: 1.25rem;
    background: #ffffff;
    box-shadow:
      0 18px 45px rgba(15, 23, 42, 0.35),
      0 0 0 1px rgba(209, 213, 219, 0.8);
    padding: 2.25rem 2rem;
  }
  .form-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 0.25rem;
  }
  .form-subtitle {
    font-size: 0.9rem;
    color: #6b7280;
    margin-bottom: 1.5rem;
  }
  /* Custom-styled select for user_type */
  #field_user_type select {
    position: relative;
    background-color: #ffffff;
    border-radius: 0.6rem;
    border: 1px solid #d1d5db;
    padding-right: 2.5rem;        /* space for custom arrow */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  #field_user_type {
    position: relative;
  }

  /* Custom arrow */
  #field_user_type::after {
    content: "";
    position: absolute;
    pointer-events: none;
    right: 0.9rem;
    top: 52%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 6px solid #6b7280;   /* arrow color */
  }

  #field_user_type select:focus {
    border-color: #14b8a6;
    box-shadow: 0 0 0 1px rgba(20, 184, 166, 0.4);
  }
  .form-label {
    font-weight: 500;
    color: #374151;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
  }
  .form-control,
  .form-select {
    border-radius: 0.6rem;
    border: 1px solid #d1d5db;
    font-size: 0.9rem;
    padding: 0.6rem 0.75rem;
  }
  .form-control:focus,
  .form-select:focus {
    border-color: #14b8a6;
    box-shadow: 0 0 0 1px rgba(20, 184, 166, 0.4);
  }
  .btn-primary-flat {
    width: 100%;
    border-radius: 999px;
    background-color: #14b8a6;
    border: none;
    color: #ffffff;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.7rem 1rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .btn-primary-flat:hover {
    background-color: #0d9488;
  }
  .field-error {
    color: #b91c1c;
    font-size: 0.78rem;
    margin-top: 0.1rem;
  }
  .auth-link {
    color: #14b8a6;
    text-decoration: none;
    font-weight: 500;
  }
  .auth-link:hover {
    text-decoration: underline;
    color: #0d9488;
  }
  <style>
  /* ...your existing styles... */

  /* Global Django error list styling */
  ul.errorlist {
    margin: 0.15rem 0 0;
    padding-left: 0;
    list-style: none;
    font-size: 0.85rem;          /* bigger text */
    color: #b91c1c;              /* red */
    font-weight: 500;
  }
  ul.errorlist li {
    margin: 0;
  }

  /* Non-field errors (e.g. "No student record found") */
  .alert-danger {
    font-size: 0.9rem;
  }

  /* Optional: keep your custom wrapper for field.errors if you use it */
  .field-error {
    color: #b91c1c;
    font-size: 0.85rem;
    margin-top: 0.15rem;
    font-weight: 500;
  }
</style>

</style>

<div class="page-wrap">
  <div class="form-card">
    <h3 class="form-title">Create your account</h3>
    <p class="form-subtitle">Use your official details to link your student or teacher profile.</p>

    <form method="post" novalidate id="regForm" autocomplete="off">
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="alert alert-danger py-2 mb-3">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      {% for field in form %}
      <div class="mb-3" id="field_{{ field.name }}">
        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
        {{ field }}
        {% if field.help_text %}
          <small class="form-text text-muted">{{ field.help_text }}</small>
        {% endif %}
        {% if field.errors %}
          <div class="field-error">
            {{ field.errors }}
          </div>
        {% endif %}
      </div>
      {% endfor %}

      <button type="submit" class="btn btn-primary-flat mt-1">
        Continue
      </button>
    </form>

    <p class="mt-3 mb-0 text-center" style="font-size:0.85rem; color:#6b7280;">
      Already have an account?
      <a href="{% url 'accounts:login' %}" class="auth-link">Log in</a>
    </p>
  </div>
</div>

<script>
  // Show/hide roll_number and employee_id based on user_type selection
  document.addEventListener('DOMContentLoaded', function() {
    const userTypeField = document.querySelector('select[name="user_type"]');
    const rollNumberField = document.getElementById('field_roll_number');
    const teacherIdField = document.getElementById('field_teacher_id');

    function toggleFields() {
      const userType = userTypeField ? userTypeField.value : null;
      if (!rollNumberField || !teacherIdField || !userTypeField) return;

      if (userType === 'student') {
        rollNumberField.style.display = 'block';
        teacherIdField.style.display = 'none';
      } else if (userType === 'teacher') {
        rollNumberField.style.display = 'none';
        teacherIdField.style.display = 'block';
      } else {
        rollNumberField.style.display = 'none';
        teacherIdField.style.display = 'none';
      }
    }

    if (userTypeField) {
      userTypeField.addEventListener('change', toggleFields);
      toggleFields();  // Run on page load
    }
  });
</script>
{% endblock %}
