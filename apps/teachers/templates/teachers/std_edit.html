<!-- teachers/templates/teachers/edit_student.html -->
{% extends 'teachers/layout.html' %}

{% block title %}Edit Student{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-xl-10">
      
      <!-- Header -->
      <div class="d-flex align-items-center justify-content-between mb-5">
        <div>
          <h1 class="mb-1">
            <i class="bi bi-person-badge-fill text-primary me-3"></i>
            Edit Student: {{ student.roll_number }}
          </h1>
          <p class="text-muted mb-0">{{ student.name }}</p>
        </div>
        <a href="{% url 'teachers:student_detail' roll_number=student.roll_number %}" 
           class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-2"></i>Back
        </a>
      </div>

      <!-- Main Form Card -->
      <div class="card shadow-xl border-0">
        <div class="card-body p-5">
          <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Row 1: Basic Info -->
            <div class="row g-4 mb-5">
              <div class="col-lg-6">
                <label class="form-label fw-semibold mb-2">Full Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control form-control-lg" name="name" 
                       value="{{ student.name }}" required>
              </div>
              <div class="col-lg-6">
                <label class="form-label fw-semibold mb-2">Roll Number <span class="text-danger">*</span></label>
                <input type="text" class="form-control form-control-lg bg-light" name="roll_number" 
                       value="{{ student.roll_number }}" required readonly>
              </div>
            </div>

            <!-- Row 2: Academic Info -->
            <div class="row g-4 mb-5">
              <div class="col-lg-4">
                <label class="form-label fw-semibold mb-2">Class ID</label>
                <input type="text" class="form-control form-control-lg" name="class_id" 
                       value="{{ student.class_id|default:'' }}">
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold mb-2">Class Name</label>
                <input type="text" class="form-control form-control-lg" name="class_name" 
                       value="{{ student.class_name|default:'' }}">
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold mb-2">Courses</label>
                <select class="form-select form-select-lg" name="courses" multiple size="6">
                  {% for course in courses %}
                    <option value="{{ course.id }}" 
                            {% if course in student.courses.all %}selected{% endif %}>
                      {{ course.name }}
                    </option>
                  {% endfor %}
                </select>
                <small class="text-muted">Hold Ctrl/Cmd to select multiple courses</small>
              </div>
            </div>

            <!-- Row 3: Personal Info -->
            <div class="row g-4 mb-5">
              <div class="col-lg-4">
                <label class="form-label fw-semibold mb-2">Gender</label>
                <select class="form-select form-select-lg" name="gender">
                  <option value="">Select Gender</option>
                  <option value="male" {% if student.gender == 'male' %}selected{% endif %}>Male</option>
                  <option value="female" {% if student.gender == 'female' %}selected{% endif %}>Female</option>
                  <option value="other" {% if student.gender == 'other' %}selected{% endif %}>Other</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold mb-2">Date of Birth</label>
                <input type="date" class="form-control form-control-lg" name="dob" 
                       value="{{ student.dob|date:'Y-m-d'|default:'' }}">
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold mb-2">Email</label>
                <input type="email" class="form-control form-control-lg" name="email" 
                       value="{{ student.email|default:student.user.email|default:'' }}">
              </div>
            </div>

            <!-- Row 4: Contact Info -->
            <div class="row g-4 mb-5">
              <div class="col-lg-6">
                <label class="form-label fw-semibold mb-2">Phone</label>
                <input type="tel" class="form-control form-control-lg" name="phone" 
                       value="{{ student.phone|default:'' }}">
              </div>
              <div class="col-lg-6">
                <label class="form-label fw-semibold mb-2">Parent Phone</label>
                <input type="tel" class="form-control form-control-lg" name="parent_phone" 
                       value="{{ student.parent_phone|default:'' }}">
              </div>
            </div>

            <!-- Row 5: Parents Info -->
            <div class="row g-4 mb-5">
              <div class="col-lg-6">
                <label class="form-label fw-semibold mb-2">Father's Name</label>
                <input type="text" class="form-control form-control-lg" name="father" 
                       value="{{ student.father|default:'' }}">
              </div>
              <div class="col-lg-6">
                <label class="form-label fw-semibold mb-2">Mother's Name</label>
                <input type="text" class="form-control form-control-lg" name="mother_name" 
                       value="{{ student.mother_name|default:'' }}">
              </div>
            </div>

            <!-- Photo Upload -->
            <div class="mb-5">
              <label class="form-label fw-semibold mb-3 d-block">Profile Photo</label>
              <div class="row">
                <div class="col-md-3">
                  {% if student.photo %}
                    <img src="{{ student.photo.url }}" class="rounded-4 shadow w-100" style="height: 160px; object-fit: cover;">
                  {% else %}
                    <div class="rounded-4 bg-light d-flex align-items-center justify-content-center border-dashed text-center p-5" style="height: 160px;">
                      <div>
                        <i class="bi bi-person-circle fs-1 text-muted mb-2 d-block"></i>
                        <small class="text-muted">No Photo</small>
                      </div>
                    </div>
                  {% endif %}
                </div>
                <div class="col-md-9">
                  <input type="file" class="form-control form-control-lg" name="photo" accept="image/*">
                  <small class="text-muted">Upload JPG, PNG or GIF (Max 2MB)</small>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex gap-3 justify-content-end flex-wrap">
              <a href="{% url 'teachers:students' %}" class="btn btn-outline-secondary btn-lg px-4">
                <i class="bi bi-list-ul me-2"></i>All Students
              </a>
              <a href="{% url 'teachers:student_detail' roll_number=student.roll_number %}" 
                 class="btn btn-outline-primary btn-lg px-4">
                <i class="bi bi-eye me-2"></i>View Details
              </a>
              <button type="submit" class="btn btn-primary btn-lg px-5">
                <i class="bi bi-check2-circle me-2"></i>
                Update Student
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Messages -->
      {% if messages %}
        <div class="mt-4">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
